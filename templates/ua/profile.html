<!-- be able to clear location -->

{% extends 'base.html' %}

{% block head %}

<link rel="manifest" href="/static/manifest-user.json">


{% endblock %}

{% block main %}
    {% include 'ua/nav.html' %}

    <div class="container">
      <br>
      <div class="jumbotron">
        <h1 class="display-6 text-center">Profile</h1>
      </div>
      <br><br>
			<table class="table table-bordered text-center">
      <thead>
				<tr>
          <th scope="col">Email - {{user["email"]}}</th>
        </tr>
        <tr>
          <th scope="col">Your Locations</th>
        </tr>
      </thead>
      <tbody id="list">

      </tbody>
    </table>
      <br><br>
			<!-- Modal -->
			<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered" role="document">
				<div class="modal-content">
					<div class="modal-body" id="address">
					</div>
					<div class="modal-footer">
					<button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal" onclick='$("#address").html("");'>Close</button>
						<button type="button" class="btn btn-dark btn-sm">Remove Address</button>
					</div>
				</div>
			</div>
			</div>
      <a href="/logout" class="btn btn-block btn-dark">Logout</a>

    </div>

{% endblock %}

{% block script %}
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCRN1uDZIOggcNRFvf2URK_hfXnrpPiEgI">
</script>
<script>

  function getAddr(vlat,vlng, entry){
var geocoder = new google.maps.Geocoder;
    latlng = { lat: vlat, lng: vlng}
    geocoder.geocode({'location': latlng}, function(results, status) {
       if (status === 'OK') {

         if (results[0]) {
          	$("#address").text(results[0].formatted_address );
            $("#exampleModalCenter").modal();
         }
     }
    });
  }
</script>


<script type="text/javascript">

vstr="";
{% for entry in req %}
	{% if req[entry]["user"] == user["email"] %}
		vlat = {{req[entry]["lat"]}};
		vlng = {{req[entry]["lng"]}};
		vstr += `<tr>
		  <th scope="row" id="{{entry}}">`+ vlat + - + vlng +`
				<!-- Button trigger modal -->
				<br>
					<button type="button" class="btn btn-dark btn-sm"  onclick="getAddr(`+vlat+`, `+vlng+`, '{{ entry }}')">
					Address
					</button>
			</th>
		</tr>`;

// setTimeout(getAddr(vlat,vlng,"{{entry}}"), 2000);
{% endif %}
{% endfor %}
$("#list").html(vstr);

</script>

{% endblock %}
