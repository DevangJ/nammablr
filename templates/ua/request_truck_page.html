{% extends 'base.html' %}

{% block head %}
<link rel="manifest" href="/static/manifest-user.json">
<style>
  /* Always set the map height explicitly to define the size of the div
   * element that contains the map. */
  #map {
    height: 100%;
  }
  /* Optional: Makes the sample page fill the window. */
  html, body {
    height: 100%;
    margin: 0;
    padding: 0;
  }
  #description {
    font-family: Roboto;
    font-size: 15px;
    font-weight: 300;
  }

  #infowindow-content .title {
    font-weight: bold;
  }

  #infowindow-content {
    display: none;
  }

  #map #infowindow-content {
    display: inline;
  }

  .pac-card {
    position: absolute;
    top:0;
    left:0;
    width: 100%;
    background-color: #fff;
  }

  #pac-input {
    padding: 10px;
    width: 100%;
    border: 0;
    font-size: 1.5em;
  }

  #title {
    color: #fff;
    background-color: #4d90fe;
    font-size: 25px;
    font-weight: 500;
    padding: 6px 12px;
  }

  #btn{
    /* display: none; */
    /* margin: 10px; */
  }

</style>

{% endblock %}

{% block main %}
  {% include 'ua/nav.html' %}

    <div class="pac-card" id="pac-card">
      <input id="pac-input" type="text"
          placeholder="Enter a location">
        <form method="post">
          <input type="hidden" name="lat" id="lat" value="">
          <input type="hidden" name="lng" id="lng" value="">
          <button type="submit" id="btn" class="btn btn-block btn-secondary bg-dark">Request Truck Here</button>
        </form>
    </div>
    <div id="map"></div>

{% endblock %}
{% block script %}
    <script>
      // This example requires the Places library. Include the libraries=places
      // parameter when you first load the API. For example:
      // <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places">

      function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 12.9715987, lng: 77.59456269999998},
          zoom: 13,
          mapTypeControl: false
        });
        var card = document.getElementById('pac-card');
        var input = document.getElementById('pac-input');
        var types = document.getElementById('type-selector');
        var strictBounds = document.getElementById('strict-bounds-selector');

        map.controls[google.maps.ControlPosition.TOP_RIGHT].push(card);

        var autocomplete = new google.maps.places.Autocomplete(input);

        // Bind the map's bounds (viewport) property to the autocomplete object,
        // so that the autocomplete requests use the current map bounds for the
        // bounds option in the request.
        autocomplete.bindTo('bounds', map);

        // Set the data fields to return when the user selects a place.
        autocomplete.setFields(
            ['address_components', 'geometry', 'icon', 'name']);

        var infowindow = new google.maps.InfoWindow();
        var infowindowContent = document.getElementById('infowindow-content');
        infowindow.setContent(infowindowContent);
        var marker = new google.maps.Marker({
          map: map,
          anchorPoint: new google.maps.Point(12.9715987, 77.59456269999998)
        });
				// current loc
				if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            var pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };
            $("#lat").val(pos.lat);
            $("#lng").val(pos.lng);

						map.setCenter(pos);
						marker.setPosition(pos);
					});}

          google.maps.event.addListener(map, 'click', function(event) {
             placeMarker(event.latLng);
          });

          function placeMarker(location) {
              var marker = new google.maps.Marker({
                  position: location,
                  map: map
              });
          }

					// current loc ends
        autocomplete.addListener('place_changed', function() {
          infowindow.close();
          marker.setVisible(false);
          var place = autocomplete.getPlace();
          if (!place.geometry) {
            // User entered the name of a Place that was not suggested and
            // pressed the Enter key, or the Place Details request failed.
            window.alert("No details available for input: '" + place.name + "'");
            return;
          }

          // If the place has a geometry, then present it on a map.
          if (place.geometry.viewport) {
            map.fitBounds(place.geometry.viewport);
          } else {
            map.setCenter(place.geometry.location);
            map.setZoom(17);  // Why 17? Because it looks good.
          }
          marker.setPosition(place.geometry.location);
          // alert(place.geometry.location.lat());
          $("#lat").val(place.geometry.location.lat());
          $("#lng").val(place.geometry.location.lng());
          $("#btn").css("display","block");

          marker.setVisible(true);



        });

      }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCRN1uDZIOggcNRFvf2URK_hfXnrpPiEgI&libraries=places&callback=initMap"
        async defer></script>

{% endblock %}
